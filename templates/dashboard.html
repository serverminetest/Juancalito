{% extends "base.html" %}

{% block title %}Dashboard - Sistema de Gestión{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Header con saludo personalizado -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-gradient-primary text-white shadow-lg">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col">
                        <h2 class="mb-1">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            ¡Bienvenido al Sistema de Gestión!
                        </h2>
                        <p class="mb-0 opacity-75">
                            <i class="fas fa-calendar-day me-1"></i>
                            <span id="fechaHoraActual"></span>
                        </p>
                    </div>
                    <div class="col-auto">
                        <div class="text-center">
                            <i class="fas fa-building fa-3x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tarjetas de estadísticas principales -->
<div class="row mb-4">
    <!-- Empleados -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            Empleados Activos
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_empleados }}</div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-user-plus text-success"></i> +{{ empleados_recientes }} este mes
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-users fa-2x text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Asistencias Hoy -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Asistencias Hoy
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ asistencias_hoy }}</div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-chart-line text-info"></i> {{ asistencias_semana }} esta semana
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-clock fa-2x text-success"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Visitantes -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            Visitantes Hoy
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_visitantes_hoy }}</div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-calendar-alt text-warning"></i> {{ total_visitantes_mes }} este mes
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-user-friends fa-2x text-info"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contratos -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                            Contratos por Vencer
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ contratos_vencer }}</div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-file-contract text-primary"></i> {{ total_contratos_activos }} activos
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Segunda fila de estadísticas -->
<div class="row mb-4">
    <!-- Inventarios -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-secondary shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                            Productos en Inventario
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_productos }}</div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-exclamation-circle text-danger"></i> {{ productos_stock_bajo }} stock bajo
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-boxes fa-2x text-secondary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contratos Generados -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-dark shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                            Contratos Generados Hoy
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ contratos_generados_hoy }}</div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-file-excel text-success"></i> Archivos Excel
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-file-excel fa-2x text-dark"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empleados Inactivos -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-danger shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                            Empleados Inactivos
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_empleados_inactivos }}</div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-user-slash text-muted"></i> Requieren revisión
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-user-times fa-2x text-danger"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resumen General -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-light shadow h-100">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-light text-uppercase mb-1">
                            Estado del Sistema
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            <i class="fas fa-check-circle text-success"></i> Operativo
                        </div>
                        <div class="text-xs text-muted">
                            <i class="fas fa-server text-info"></i> Todos los módulos activos
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-server fa-2x text-light"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acciones Rápidas y Información del Sistema -->
<div class="row">
    <!-- Acciones Rápidas Mejoradas -->
    <div class="col-lg-8 mb-4">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h6 class="m-0 font-weight-bold">
                    <i class="fas fa-bolt me-2"></i>Acciones Rápidas
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('nuevo_empleado') }}" class="btn btn-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                            <i class="fas fa-user-plus fa-2x mb-2"></i>
                            <span>Nuevo Empleado</span>
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('nuevo_visitante') }}" class="btn btn-info w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                            <i class="fas fa-user-friends fa-2x mb-2"></i>
                            <span>Registrar Visitante</span>
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('asistencia') }}" class="btn btn-success w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                            <i class="fas fa-clock fa-2x mb-2"></i>
                            <span>Registrar Asistencia</span>
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('contratos') }}" class="btn btn-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                            <i class="fas fa-file-contract fa-2x mb-2"></i>
                            <span>Gestionar Contratos</span>
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('inventarios') }}" class="btn btn-secondary w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                            <i class="fas fa-boxes fa-2x mb-2"></i>
                            <span>Control Inventarios</span>
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('reportes') }}" class="btn btn-dark w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                            <i class="fas fa-chart-bar fa-2x mb-2"></i>
                            <span>Ver Reportes</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Información del Sistema (Mantenido como solicitaste) -->
    <div class="col-lg-4 mb-4">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h6 class="m-0 font-weight-bold">
                    <i class="fas fa-info-circle me-2"></i>Información del Sistema
                </h6>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <i class="fas fa-calendar-alt fa-3x text-primary mb-3"></i>
                    <h5>Fecha Actual</h5>
                    <p class="text-muted" id="fechaActual"></p>
                    
                    <hr>
                    
                    <h6>Funcionalidades Disponibles:</h6>
                    <ul class="list-unstyled text-left">
                        <li><i class="fas fa-check text-success"></i> Gestión de Empleados</li>
                        <li><i class="fas fa-check text-success"></i> Control de Contratos</li>
                        <li><i class="fas fa-check text-success"></i> Registro de Asistencia</li>
                        <li><i class="fas fa-check text-success"></i> Control de Visitantes</li>
                        <li><i class="fas fa-check text-success"></i> Gestión de Inventarios</li>
                        <li><i class="fas fa-check text-success"></i> Reportes y Estadísticas</li>
                    </ul>
                    
                    <hr>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> Usa las acciones rápidas para acceder a las funciones más utilizadas.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Alertas y Notificaciones -->
{% if contratos_vencer > 0 or productos_stock_bajo > 0 %}
<div class="row">
    <div class="col-12">
        <div class="card border-warning shadow">
            <div class="card-header bg-warning text-dark">
                <h6 class="m-0 font-weight-bold">
                    <i class="fas fa-exclamation-triangle me-2"></i>Alertas Importantes
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    {% if contratos_vencer > 0 %}
                    <div class="col-md-6">
                        <div class="alert alert-warning">
                            <i class="fas fa-file-contract me-2"></i>
                            <strong>{{ contratos_vencer }}</strong> contrato(s) próximo(s) a vencer en 30 días
                        </div>
                    </div>
                    {% endif %}
                    {% if productos_stock_bajo > 0 %}
                    <div class="col-md-6">
                        <div class="alert alert-danger">
                            <i class="fas fa-boxes me-2"></i>
                            <strong>{{ productos_stock_bajo }}</strong> producto(s) con stock bajo
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
.border-left-primary { border-left: 0.25rem solid #4e73df !important; }
.border-left-success { border-left: 0.25rem solid #1cc88a !important; }
.border-left-info { border-left: 0.25rem solid #36b9cc !important; }
.border-left-warning { border-left: 0.25rem solid #f6c23e !important; }
.border-left-danger { border-left: 0.25rem solid #e74a3b !important; }
.border-left-secondary { border-left: 0.25rem solid #858796 !important; }
.border-left-dark { border-left: 0.25rem solid #5a5c69 !important; }
.border-left-light { border-left: 0.25rem solid #f8f9fc !important; }

.text-xs { font-size: 0.7rem; }
.font-weight-bold { font-weight: 700 !important; }
.text-uppercase { text-transform: uppercase !important; }
.text-gray-800 { color: #5a5c69 !important; }

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-2px);
}

.btn {
    transition: all 0.3s ease;
    min-height: 80px;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
</style>

<script>
// Mostrar fecha y hora actual
document.addEventListener('DOMContentLoaded', function() {
    function actualizarFechaHora() {
        const ahora = new Date();
        const opciones = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            weekday: 'long'
        };
        document.getElementById('fechaHoraActual').textContent = 
            ahora.toLocaleDateString('es-ES', opciones);
    }
    
    // Actualizar inmediatamente
    actualizarFechaHora();
    
    // Actualizar cada segundo
    setInterval(actualizarFechaHora, 1000);
    
    // Fecha simple para el cuadro de información
    const fechaActual = new Date();
    const opcionesFecha = { 
        year: 'numeric', 
        month: '2-digit', 
        day: '2-digit' 
    };
    document.getElementById('fechaActual').textContent = 
        fechaActual.toLocaleDateString('es-ES', opcionesFecha);
});

// Animación de entrada para las tarjetas
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}